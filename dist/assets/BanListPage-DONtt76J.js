import{_ as W,r as c,f as T,g as j,o as R,u as V,h as P,c as a,a as e,i as _,b as q,t as r,w as F,v as H,F as L,j as N,d as X,k as z,e as n}from"./index-fSWgsSel.js";const Q={class:"ban-list-container"},Y={key:0,class:"loading"},G={key:1,class:"error"},K={key:0,class:"debug-info"},Z={key:2},ee={class:"search-container"},se={key:0,class:"debug-info"},te={key:1,class:"empty-state"},ae={key:2,class:"bans-list"},ne={class:"ban-header"},le={class:"user-id"},ie={class:"ban-date"},oe={class:"ban-content"},re={class:"reason"},ue={class:"text"},ce={class:"proofs"},de={class:"text"},ve={key:0,class:"screenshots"},_e={class:"screenshots-grid"},pe=["src","onClick"],ge={class:"ban-footer"},he={class:"admin-id"},me={class:"slider-content"},ye=["src"],fe={class:"slider-counter"},be={__name:"BanListPage",setup(ke){const O=V(),m=c([]),b=c(!0),y=c(null),v=c(""),k=c(5),w=c(null),l=c(""),$=T(()=>{if(!v.value)return m.value;const t=v.value.toLowerCase().trim();return m.value.filter(s=>String(s.user_id).includes(t))}),D=T(()=>$.value.slice(0,k.value)),I=T(()=>k.value<$.value.length),M=()=>{k.value+=5},f=c(!1),p=c([]),u=c(0),E=(t,s=0)=>{p.value=t,u.value=s,f.value=!0},B=()=>{f.value=!1,p.value=[],u.value=0},J=()=>{u.value<p.value.length-1&&u.value++},U=()=>{u.value>0&&u.value--},C=async(t="")=>{var s,i,g;try{b.value=!0,y.value=null,l.value="";const d=(s=window.Telegram)==null?void 0:s.WebApp,h="/USFAPI/bans";l.value+=`Отправляем запрос на: ${h}${t?`?search_id=${t}`:""}
`;const o=await z.get(`${h}${t?`?search_id=${t}`:""}`,{headers:{Accept:"application/json","Content-Type":"application/json","X-Requested-With":"XMLHttpRequest",Authorization:JSON.stringify({id:((g=(i=d==null?void 0:d.initDataUnsafe)==null?void 0:i.user)==null?void 0:g.id)||"7980053081"})}});if(l.value+=`Статус ответа: ${o.status}
`,l.value+=`Заголовки ответа: ${JSON.stringify(o.headers)}
`,l.value+=`Тип данных: ${typeof o.data}
`,l.value+=`Данные: ${JSON.stringify(o.data)}
`,typeof o.data=="string"&&o.data.includes("<!DOCTYPE html>"))throw new Error("Сервер вернул HTML вместо JSON. Проверьте настройки прокси и CORS.");if(!o.data)throw new Error("Нет данных от сервера");const A=Array.isArray(o.data)?o.data:o.data.bans?o.data.bans:[o.data];l.value+=`Обработанные данные: ${JSON.stringify(A,null,2)}
`,m.value=A.map(S=>({...S,ban_date:S.ban_date?new Date(S.ban_date).toLocaleString("ru-RU"):"Дата не указана"})),l.value+=`Финальный результат: ${JSON.stringify(m.value,null,2)}
`}catch(d){l.value+=`Полная ошибка: ${d.message}
`,l.value+=`Стек ошибки: ${d.stack}
`,y.value=`Ошибка при загрузке списка банов: ${d.message}`}finally{b.value=!1}},x=()=>{document.visibilityState==="visible"&&C(v.value)};return j(v,t=>{w.value&&clearTimeout(w.value),w.value=setTimeout(()=>{C(t)},300)}),R(()=>{var t;if((t=window.Telegram)!=null&&t.WebApp){const s=window.Telegram.WebApp;s.BackButton.show(),s.BackButton.onClick(()=>{f.value?B():O.push("/admin")})}C(),document.addEventListener("visibilitychange",x)}),P(()=>{var t;(t=window.Telegram)!=null&&t.WebApp&&window.Telegram.WebApp.BackButton.hide(),document.removeEventListener("visibilitychange",x)}),(t,s)=>(n(),a("div",Q,[s[5]||(s[5]=e("h1",{class:"page-title"},"Список банов",-1)),b.value?(n(),a("div",Y," Загрузка списка банов... ")):y.value?(n(),a("div",G,[q(r(y.value)+" ",1),l.value?(n(),a("pre",K,r(l.value),1)):_("",!0)])):(n(),a("div",Z,[e("div",ee,[F(e("input",{"onUpdate:modelValue":s[0]||(s[0]=i=>v.value=i),type:"text",placeholder:"Поиск по ID пользователя...",class:"search-input"},null,512),[[H,v.value]])]),l.value?(n(),a("pre",se,r(l.value),1)):_("",!0),$.value.length===0?(n(),a("div",te,r(v.value?"Баны не найдены":"Список банов пуст"),1)):(n(),a("div",ae,[(n(!0),a(L,null,N(D.value,i=>{var g;return n(),a("div",{key:i.id,class:"ban-card"},[e("div",ne,[e("div",le,"ID: "+r(i.user_id),1),e("div",ie,r(i.ban_date),1)]),e("div",oe,[e("div",re,[s[2]||(s[2]=e("span",{class:"label"},"Причина:",-1)),e("span",ue,r(i.reason),1)]),e("div",ce,[s[3]||(s[3]=e("span",{class:"label"},"Доказательства:",-1)),e("span",de,r(i.proofs),1)]),(g=i.images)!=null&&g.length?(n(),a("div",ve,[s[4]||(s[4]=e("span",{class:"label"},"Скриншоты:",-1)),e("div",_e,[(n(!0),a(L,null,N(i.images,(d,h)=>(n(),a("div",{key:h,class:"screenshot-container"},[e("img",{src:"data:image/jpeg;base64,"+d,class:"screenshot",onClick:o=>E(i.images,h)},null,8,pe)]))),128))])])):_("",!0)]),e("div",ge,[e("div",he,"Администратор: "+r(i.admin_id),1)])])}),128)),I.value?(n(),a("button",{key:0,onClick:M,class:"load-more-button"}," Показать ещё... ")):_("",!0)]))])),f.value?(n(),a("div",{key:3,class:"slider-overlay",onClick:B},[e("div",{class:"slider-container",onClick:s[1]||(s[1]=X(()=>{},["stop"]))},[e("button",{class:"slider-close",onClick:B},"×"),e("div",me,[u.value>0?(n(),a("button",{key:0,class:"slider-nav prev",onClick:U}," ‹ ")):_("",!0),e("img",{src:"data:image/jpeg;base64,"+p.value[u.value],class:"slider-image"},null,8,ye),u.value<p.value.length-1?(n(),a("button",{key:1,class:"slider-nav next",onClick:J}," › ")):_("",!0)]),e("div",fe,r(u.value+1)+" / "+r(p.value.length),1)])])):_("",!0)]))}},$e=W(be,[["__scopeId","data-v-73ab4947"]]);export{$e as default};
